<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap");

      :root {
        --header-height: 3rem;
        --nav-width: 68px;
        --first-color: #4723d9;
        --first-color-light: #afa5d9;
        --white-color: #f7f6fb;
        --body-font: "Nunito", sans-serif;
        --normal-font-size: 1rem;
        --z-fixed: 100;
      }

      *,
      ::before,
      ::after {
        box-sizing: border-box;
      }

      body {
        position: relative;
        margin: var(--header-height) 0 0 0;
        padding: 0 1rem;
        font-family: var(--body-font);
        font-size: var(--normal-font-size);
        transition: 0.5s;
      }

      a {
        text-decoration: none;
      }

      .header {
        width: 100%;
        height: var(--header-height);
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
        background-color: var(--white-color);
        z-index: var(--z-fixed);
        transition: 0.5s;
      }

      .header_toggle {
        color: var(--first-color);
        font-size: 1.5rem;
        cursor: pointer;
      }

      .header_img {
        width: 35px;
        height: 35px;
        display: flex;
        justify-content: center;
        border-radius: 50%;
        overflow: hidden;
      }

      .header_img img {
        width: 40px;
      }

      .l-navbar {
        position: fixed;
        top: 0;
        left: -30%;
        width: var(--nav-width);
        height: 100vh;
        background-color: var(--first-color);
        padding: 0.5rem 1rem 0 0;
        transition: 0.5s;
        z-index: var(--z-fixed);
      }

      .nav {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        overflow: hidden;
      }

      .nav_logo,
      .nav_link {
        display: grid;
        grid-template-columns: max-content max-content;
        align-items: center;
        column-gap: 1rem;
        padding: 0.5rem 0 0.5rem 1.5rem;
      }

      .nav_logo {
        margin-bottom: 2rem;
      }

      .nav_logo-icon {
        font-size: 1.25rem;
        color: var(--white-color);
      }

      .nav_logo-name {
        color: var(--white-color);
        font-weight: 700;
      }

      .nav_link {
        position: relative;
        color: var(--first-color-light);
        margin-bottom: 1.5rem;
        transition: 0.3s;
      }

      .nav_link:hover {
        color: var(--white-color);
      }

      .nav_icon {
        font-size: 1.25rem;
      }

      .show {
        left: 0;
      }

      .body-pd {
        padding-left: calc(var(--nav-width) + 1rem);
      }

      .active {
        color: var(--white-color);
      }

      .active::before {
        content: "";
        position: absolute;
        left: 0;
        width: 2px;
        height: 32px;
        background-color: var(--white-color);
      }

      .height-100 {
        height: 100vh;
      }

      @media screen and (min-width: 768px) {
        body {
          margin: calc(var(--header-height) + 1rem) 0 0 0;
          padding-left: calc(var(--nav-width) + 2rem);
        }

        .header {
          height: calc(var(--header-height) + 1rem);
          padding: 0 2rem 0 calc(var(--nav-width) + 2rem);
        }

        .header_img {
          width: 40px;
          height: 40px;
        }

        .header_img img {
          width: 45px;
        }

        .l-navbar {
          left: 0;
          padding: 1rem 1rem 0 0;
        }

        .show {
          width: calc(var(--nav-width) + 156px);
        }

        .body-pd {
          padding-left: calc(var(--nav-width) + 188px);
        }
      }

      .logout {
        margin-top: auto;
      }

      /* Custom styles for the dashboard content */
      .status-card {
        cursor: pointer;
        transition: transform 0.2s;
      }

      .status-card:hover {
        transform: translateY(-5px);
      }

      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .month-nav {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .month-nav button {
        background: var(--first-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.3s;
      }

      .month-nav button:hover {
        background: var(--first-color-light);
      }

      .month-nav h4 {
        margin: 0;
        min-width: 200px;
        text-align: center;
      }

      .calendar-container {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #dee2e6;
        border-radius: 10px;
        overflow: hidden;
      }

      .calendar-day-header {
        background: var(--first-color);
        color: white;
        padding: 15px 5px;
        text-align: center;
        font-weight: bold;
        font-size: 0.9rem;
      }

      .calendar-day {
        background: white;
        padding: 10px 5px;
        min-height: 100px;
        position: relative;
        font-size: 0.9rem;
        border-bottom: 1px solid #f0f0f0;
      }

      .calendar-day.today {
        background: #e3f2fd;
      }

      .calendar-day.other-month {
        background: #f8f9fa;
        color: #6c757d;
      }

      .calendar-event {
        background: var(--first-color);
        color: white;
        padding: 2px 4px;
        border-radius: 4px;
        font-size: 0.7rem;
        margin: 2px 0;
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .calendar-event.approved {
        background: #28a745;
      }
      .calendar-event.pending {
        background: #ffc107;
        color: #000;
      }
      .calendar-event.rejected {
        background: #dc3545;
      }

      .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 20px;
      }

      .chart-small {
        height: 300px;
      }
    </style>
  </head>

  <body id="body-pd">
    <header class="header" id="header">
      <div class="header_toggle">
        <i class="bx bx-menu" id="header-toggle"></i>
      </div>
    </header>

    <div class="l-navbar" id="nav-bar">
      <nav class="nav">
        <div>
          <a href="#" class="nav_logo">
            <i class="bx bx-buildings nav_logo-icon"></i>
            <span class="nav_logo-name">PFRS</span>
          </a>
          <div class="nav_list">
            <a href="#" class="nav_link active">
              <i class="bx bx-home nav_icon"></i>
              <span class="nav_name">Home</span>
            </a>
            <a href="#" class="nav_link">
              <i class="bx bx-plus-circle nav_icon"></i>
              <span class="nav_name">Add Facility</span>
            </a>
            <a href="#" class="nav_link">
              <i class="bx bx-calendar-event nav_icon"></i>
              <span class="nav_name">Reservation History</span>
            </a>
            <a href="#" class="nav_link">
              <i class="bx bx-check nav_icon"></i>
              <span class="nav_name">Approval</span>
            </a>
            <a href="#" class="nav_link">
              <i class="fas fa-bullhorn nav_icon"></i>
              <span class="nav_name">Announcement</span>
            </a>
            <div class="logout">
              <a href="#" class="nav_link">
                <i class="bx bx-log-out nav_icon"></i>
                <span class="nav_name">Sign Out</span>
              </a>
            </div>
          </div>
        </div>
      </nav>
    </div>

    <main class="container-fluid mt-4">
      <h2 class="mb-4">Facility Admin Dashboard</h2>

      <!-- Summary Cards -->
      <div class="row mb-4" id="summaryCards">
        <div class="col-md-3">
          <div class="card text-white bg-primary mb-3 status-card">
            <div class="card-body">
              <h5>Total</h5>
              <p class="card-text fs-3">47</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-warning mb-3 status-card">
            <div class="card-body">
              <h5>Pending</h5>
              <p class="card-text fs-3">12</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-success mb-3 status-card">
            <div class="card-body">
              <h5>Approved</h5>
              <p class="card-text fs-3">28</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-white bg-danger mb-3 status-card">
            <div class="card-body">
              <h5>Rejected/Cancelled</h5>
              <p class="card-text fs-3">7</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Analytics Charts Row -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Most Used Facilities</h5>
              <div class="chart-container chart-small">
                <canvas id="facilitiesChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Top Organizations</h5>
              <div class="chart-container chart-small">
                <canvas id="organizationsChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Academic vs Non-Academic</h5>
              <div class="chart-container chart-small">
                <canvas id="academicChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="calendar-header">
            <h5>Reservation Calendar</h5>
            <div class="month-nav">
              <button onclick="changeMonth(-1)">
                <i class="bx bx-chevron-left"></i>
              </button>
              <h4 id="currentMonth">June 2025</h4>
              <button onclick="changeMonth(1)">
                <i class="bx bx-chevron-right"></i>
              </button>
            </div>
          </div>
          <div class="calendar-container" id="calendarContainer">
            <!-- Calendar will be generated here -->
          </div>
        </div>
      </div>

      <!-- Recent Reservations -->
      <div class="card mb-4">
        <div class="card-body">
          <h5>Recent Reservations</h5>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Event</th>
                <th>Facility</th>
                <th>Organization</th>
                <th>Start Time</th>
                <th>Status</th>
                <th>Person In Charge</th>
              </tr>
            </thead>
            <tbody id="recentReservations">
              <!-- Table content will be generated here -->
            </tbody>
          </table>
          <div class="d-flex justify-content-end mt-3">
            <button class="btn btn-primary" onclick="generateReports()">
              Generate Reports
            </button>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Sample data - replace with actual data from your backen

      let currentDate = new Date(2025, 5, 1); // June 2025
      let reservations = sampleReservations;

      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", function () {
        initializeNavbar();
        renderCalendar();
        renderRecentReservations();
        renderCharts();
      });

      function initializeNavbar() {
        const toggle = document.getElementById("header-toggle");
        const nav = document.getElementById("nav-bar");
        const bodypd = document.getElementById("body-pd");
        const headerpd = document.getElementById("header");

        if (toggle) {
          toggle.addEventListener("click", () => {
            nav.classList.toggle("show");
            toggle.classList.toggle("bx-x");
            bodypd.classList.toggle("body-pd");
            headerpd.classList.toggle("body-pd");
          });
        }
      }

      function changeMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        renderCalendar();
      }

      function renderCalendar() {
        const monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];

        document.getElementById("currentMonth").textContent = `${
          monthNames[currentDate.getMonth()]
        } ${currentDate.getFullYear()}`;

        const firstDay = new Date(
          currentDate.getFullYear(),
          currentDate.getMonth(),
          1
        );
        const lastDay = new Date(
          currentDate.getFullYear(),
          currentDate.getMonth() + 1,
          0
        );
        const today = new Date();

        let calendarHTML = `
          <div class="calendar-day-header">Sun</div>
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>
        `;

        // Add empty cells for days before the first day of the month
        for (let i = 0; i < firstDay.getDay(); i++) {
          const prevMonthDay = new Date(
            firstDay.getTime() - (firstDay.getDay() - i) * 24 * 60 * 60 * 1000
          );
          calendarHTML += `<div class="calendar-day other-month">${prevMonthDay.getDate()}</div>`;
        }

        // Add days of the current month
        for (let day = 1; day <= lastDay.getDate(); day++) {
          const currentDay = new Date(
            currentDate.getFullYear(),
            currentDate.getMonth(),
            day
          );
          const isToday = currentDay.toDateString() === today.toDateString();

          const dayEvents = reservations.filter((r) => {
            const eventDate = new Date(r.startTime);
            return (
              eventDate.getDate() === day &&
              eventDate.getMonth() === currentDate.getMonth() &&
              eventDate.getFullYear() === currentDate.getFullYear()
            );
          });

          let eventsHTML = "";
          dayEvents.forEach((event) => {
            eventsHTML += `<div class="calendar-event ${event.status}">${event.eventName}</div>`;
          });

          calendarHTML += `
            <div class="calendar-day ${isToday ? "today" : ""}">
              ${day}
              ${eventsHTML}
            </div>
          `;
        }

        // Fill remaining cells
        const totalCells =
          Math.ceil((firstDay.getDay() + lastDay.getDate()) / 7) * 7;
        const remainingCells =
          totalCells - (firstDay.getDay() + lastDay.getDate());
        for (let i = 1; i <= remainingCells; i++) {
          calendarHTML += `<div class="calendar-day other-month">${i}</div>`;
        }

        document.getElementById("calendarContainer").innerHTML = calendarHTML;
      }

      function renderRecentReservations() {
        const tbody = document.getElementById("recentReservations");
        const recentReservations = reservations.slice(0, 10);

        tbody.innerHTML = recentReservations
          .map(
            (r) => `
          <tr>
            <td>${r.eventName}</td>
            <td>${r.facility}</td>
            <td>${r.organization}</td>
            <td>${new Date(r.startTime).toLocaleString()}</td>
            <td><span class="badge bg-${getStatusBadge(r.status)}">${
              r.status
            }</span></td>
            <td>${r.personInCharge}</td>
          </tr>
        `
          )
          .join("");
      }

      function getStatusBadge(status) {
        switch (status) {
          case "approved":
            return "success";
          case "pending":
            return "warning";
          case "rejected":
          case "cancelled":
            return "danger";
          default:
            return "secondary";
        }
      }

      function renderCharts() {
        renderFacilitiesChart();
        renderOrganizationsChart();
        renderAcademicChart();
      }

      function renderFacilitiesChart() {
        const facilityCount = {};
        reservations.forEach((r) => {
          facilityCount[r.facility] = (facilityCount[r.facility] || 0) + 1;
        });

        const sortedFacilities = Object.entries(facilityCount)
          .sort(([, a], [, b]) => b - a)
          .slice(0, 5);

        const ctx = document.getElementById("facilitiesChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: sortedFacilities.map(([name]) => name),
            datasets: [
              {
                label: "Reservations",
                data: sortedFacilities.map(([, count]) => count),
                backgroundColor: [
                  "#4723d9",
                  "#28a745",
                  "#ffc107",
                  "#dc3545",
                  "#17a2b8",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                },
              },
            },
          },
        });
      }

      function renderOrganizationsChart() {
        const orgCount = {};
        reservations.forEach((r) => {
          orgCount[r.organization] = (orgCount[r.organization] || 0) + 1;
        });

        const sortedOrgs = Object.entries(orgCount)
          .sort(([, a], [, b]) => b - a)
          .slice(0, 6);

        const ctx = document
          .getElementById("organizationsChart")
          .getContext("2d");
        new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: sortedOrgs.map(([name]) => name),
            datasets: [
              {
                data: sortedOrgs.map(([, count]) => count),
                backgroundColor: [
                  "#4723d9",
                  "#28a745",
                  "#ffc107",
                  "#dc3545",
                  "#17a2b8",
                  "#6f42c1",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
              },
            },
          },
        });
      }

      function renderAcademicChart() {
        const academicCount = reservations.filter(
          (r) => r.type === "academic"
        ).length;
        const nonAcademicCount = reservations.filter(
          (r) => r.type === "non-academic"
        ).length;

        const ctx = document.getElementById("academicChart").getContext("2d");
        new Chart(ctx, {
          type: "pie",
          data: {
            labels: ["Academic", "Non-Academic"],
            datasets: [
              {
                data: [academicCount, nonAcademicCount],
                backgroundColor: ["#28a745", "#ffc107"],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
              },
            },
          },
        });
      }

      function generateReports() {
        const headers = [
          "ID",
          "Event Name",
          "Facility",
          "Organization",
          "Start Time",
          "End Time",
          "Status",
          "Person In Charge",
          "Type",
        ];
        // Convert the reservations data to CSV format
        const csvRows = [];
        csvRows.push(headers.join(",")); // Add headers

        for (const reservation of reservations) {
          const values = [
            reservation.id,
            `"${reservation.eventName.replace(/"/g, '""')}"`, // Handle commas in event name
            `"${reservation.facility.replace(/"/g, '""')}"`,
            `"${reservation.organization.replace(/"/g, '""')}"`,
            `"${new Date(reservation.startTime).toLocaleString()}"`,
            `"${new Date(reservation.endTime).toLocaleString()}"`,
            reservation.status,
            `"${reservation.personInCharge.replace(/"/g, '""')}"`,
            reservation.type,
          ];
          csvRows.push(values.join(","));
        }

        const csvString = csvRows.join("\n");
        const blob = new Blob([csvString], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "reservations_report.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a); // Clean up the DOM
        URL.revokeObjectURL(url); // Free up memory
      }
    </script>
  </body>
</html>
