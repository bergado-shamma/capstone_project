<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Facility Management</title>
    <link rel="stylesheet" href="./add-facillty.css" />

    <!-- Bootstrap CSS (Only once) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Boxicons -->
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <style>
      /* Fix modal positioning and make it smaller */
      .modal-dialog {
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        margin: 0 !important;
        z-index: 1050 !important;
        width: 75% !important;
        max-width: 900px !important;
        height: 80vh !important;
        max-height: 600px !important;
      }

      .modal-backdrop {
        z-index: 1040 !important;
      }

      /* Ensure modal is centered regardless of sidebar */
      .modal {
        z-index: 1050 !important;
      }

      /* Make modal content scrollable */
      .modal-content {
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px 10px 0 0;
        flex-shrink: 0;
      }

      .modal-title {
        color: white;
        font-weight: 600;
      }

      .btn-close {
        filter: invert(1);
      }

      /* Make modal body scrollable */
      .modal-body {
        padding: 1.5rem !important;
        overflow-y: auto;
        flex: 1;
        max-height: calc(80vh - 120px);
      }

      .modal-footer {
        flex-shrink: 0;
        padding: 1rem 1.5rem;
      }

      .form-control {
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        padding: 0.5rem 0.75rem;
      }

      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .form-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.4rem;
        font-size: 0.9rem;
      }

      .section-header {
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 0.4rem;
        margin-bottom: 1rem;
      }

      .section-header h6 {
        font-size: 1rem;
        margin-bottom: 0;
      }

      /* Compact spacing for form elements */
      .mb-3 {
        margin-bottom: 1rem !important;
      }

      .row.g-4 {
        --bs-gutter-y: 1rem;
      }

      /* Compact properties section */
      .properties-container {
        margin-top: 1rem;
      }

      .bg-light.rounded {
        padding: 0.75rem !important;
        margin-top: 1rem !important;
      }

      .bg-light.rounded small {
        font-size: 0.8rem;
      }

      /* Responsive adjustments */
      @media (max-width: 992px) {
        .modal-dialog {
          width: 90% !important;
          max-width: none !important;
        }
      }

      @media (max-width: 768px) {
        .modal-dialog {
          width: 95% !important;
          height: 85vh !important;
        }

        .modal-body {
          padding: 1rem !important;
        }
      }

      /* Custom scrollbar for webkit browsers */
      .modal-body::-webkit-scrollbar {
        width: 6px;
      }

      .modal-body::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }

      .modal-body::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
      }

      .modal-body::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }
    </style>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/path/to/favicon.ico" />

    <!-- PocketBase -->
    <script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>
  </head>
  <body id="body-pd">
    <header class="header" id="header">
      <div class="header_toggle">
        <i class="bx bx-menu" id="header-toggle"></i>
      </div>
    </header>

    <div class="l-navbar" id="nav-bar">
      <nav class="nav">
        <div>
          <a href="#" class="nav_logo">
            <img
              src="/assets/puplogo.png"
              alt="PFRS Logo"
              class="nav_logo-icon"
            />
            <span class="nav_logo-name">PFRS</span>
          </a>
          <div class="nav_list">
            <a href="/dashboards/facility-admin/home.html" class="nav_link">
              <i class="bx bx-home nav_icon"></i>
              <span class="nav_name">Home</span>
            </a>
            <a
              href="/dashboards/facility-admin/add-facility/add-facility.html"
              class="nav_link active"
            >
              <i class="bx bx-plus-circle nav_icon" style="color: #ffffff"></i>
              <span class="nav_name">Add Facility</span>
            </a>
            <a
              href="/dashboards/facility-admin/reservation-history/reservation-history.html"
              class="nav_link"
            >
              <i class="bx bx-calendar-event nav_icon"></i>
              <span class="nav_name">Reservation History</span>
            </a>
            <a
              href="/dashboards/facility-admin/approval/approval.html"
              class="nav_link"
            >
              <i class="bx bx-check nav_icon"></i>
              <span class="nav_name">Approval</span>
            </a>
            <div class="logout">
              <a href="#" class="nav_link">
                <i class="bx bx-log-out nav_icon"></i>
                <span class="nav_name">Sign Out</span>
              </a>
            </div>
          </div>
        </div>
      </nav>
    </div>

    <div class="main-content container mt-4">
      <h1 class="mb-4">
        <i class="fas fa-building me-2"></i>Facility Management
      </h1>

      <!-- Add Facility Button - Moved inside main content -->
      <div class="add-facility-container mb-4">
        <button class="btn btn-success" onclick="openAddFacilityModal()">
          <i class="fas fa-plus me-2"></i>Add Facility
        </button>
      </div>

      <div id="facility-list" class="row"></div>
      <div id="error-message" class="alert alert-danger d-none"></div>
      <div id="success-message" class="alert alert-success d-none"></div>
    </div>

    <!-- Add Facility Modal -->
    <div
      class="modal fade"
      id="addFacilityModal"
      tabindex="-1"
      aria-labelledby="addFacilityModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-plus-circle me-2"></i>Add New Facility
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row g-4">
              <!-- Left Column - Basic Information -->
              <div class="col-lg-6">
                <div class="section-header">
                  <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2 text-primary"></i>Basic
                    Information
                  </h6>
                </div>

                <div class="mb-3">
                  <label class="form-label">
                    <i class="fas fa-tag me-1 text-muted"></i>Facility Name *
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    id="newFacilityName"
                    required
                    placeholder="Enter facility name"
                  />
                </div>

                <div class="mb-3">
                  <label class="form-label">
                    <i class="fas fa-align-left me-1 text-muted"></i>Description
                  </label>
                  <textarea
                    class="form-control"
                    id="newFacilityDescription"
                    rows="4"
                    placeholder="Enter facility description..."
                  ></textarea>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">
                      <i class="fas fa-users me-1 text-muted"></i>Max Capacity *
                    </label>
                    <input
                      type="number"
                      class="form-control"
                      id="newFacilityCapacity"
                      required
                      min="1"
                      placeholder="Enter capacity"
                    />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">
                      <i class="fas fa-map-marker-alt me-1 text-muted"></i
                      >Location *
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="newFacilityLocation"
                      required
                      placeholder="Enter location"
                    />
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label">
                    <i class="fas fa-camera me-1 text-muted"></i>Facility Photo
                  </label>
                  <input
                    type="file"
                    class="form-control"
                    id="newFacilityPhoto"
                    accept="image/*"
                  />
                  <div class="form-text">
                    Upload an image to represent this facility
                  </div>
                </div>
              </div>

              <!-- Right Column - Properties -->
              <div class="col-lg-6">
                <div class="section-header">
                  <h6 class="mb-0">
                    <i class="fas fa-cogs me-2 text-primary"></i>Properties &
                    Equipment
                  </h6>
                </div>

                <div class="properties-container">
                  <div id="newPropertiesList" class="mb-3">
                    <!-- Properties will be added here -->
                  </div>

                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm w-100"
                    onclick="addPropertyRowToNew()"
                  >
                    <i class="fas fa-plus me-2"></i>Add Property
                  </button>
                </div>

                <div class="mt-4 p-3 bg-light rounded">
                  <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Add properties and equipment available in this facility.
                    This helps users understand what amenities are included.
                  </small>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer bg-light">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="fas fa-times me-2"></i>Cancel
            </button>
            <button class="btn btn-primary" onclick="submitNewFacility()">
              <i class="fas fa-plus me-2"></i>Create Facility
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Facility Modal -->
    <div
      class="modal fade"
      id="facilityModal"
      tabindex="-1"
      aria-labelledby="facilityModalLabel"
      aria-hidden="true"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header text-white">
            <h5 class="modal-title" id="facilityModalLabel">
              <i class="fas fa-building me-2"></i>Facility Details
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- View Mode Content -->
            <div id="modalContentView">
              <div class="row">
                <div class="col-md-5">
                  <div class="text-center mb-4">
                    <img
                      id="modalPhoto"
                      src=""
                      alt="Facility Photo"
                      class="img-fluid rounded shadow"
                      style="max-height: 250px; object-fit: cover"
                    />
                  </div>
                </div>

                <div class="col-md-7">
                  <div class="facility-details">
                    <h4 id="modalName" class="text-primary mb-3"></h4>

                    <div class="row mb-3">
                      <div class="col-sm-6">
                        <div class="info-item">
                          <i class="fas fa-users text-muted me-2"></i>
                          <strong>Max Capacity:</strong>
                          <span id="modalCapacity" class="ms-1"></span>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="info-item">
                          <i class="fas fa-map-marker-alt text-muted me-2"></i>
                          <strong>Location:</strong>
                          <span id="modalLocation" class="ms-1"></span>
                        </div>
                      </div>
                    </div>

                    <div class="description-section mb-4">
                      <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-info-circle text-muted me-2"></i>
                        <strong>Description:</strong>
                      </div>
                      <p id="modalDescription" class="text-muted ms-4"></p>
                    </div>

                    <!-- Properties Section -->
                    <div class="properties-section">
                      <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-cogs text-muted me-2"></i>
                        <strong>Properties & Equipment:</strong>
                      </div>
                      <div id="modalProperties" class="ms-4">
                        <!-- Properties will be populated here -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Edit Mode Content -->
            <div id="modalContentEdit" class="d-none">
              <form id="editForm">
                <div class="row">
                  <div class="col-md-6">
                    <!-- Basic Information -->
                    <h6>
                      <i class="fas fa-info-circle me-2"></i>Basic Information
                    </h6>

                    <div class="mb-3">
                      <label for="editName" class="form-label">
                        <i class="fas fa-tag me-1"></i>Facility Name *
                      </label>
                      <input
                        type="text"
                        id="editName"
                        class="form-control"
                        required
                        placeholder="Enter facility name"
                      />
                    </div>

                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editCapacity" class="form-label">
                          <i class="fas fa-users me-1"></i>Max Capacity *
                        </label>
                        <input
                          type="number"
                          id="editCapacity"
                          class="form-control"
                          min="1"
                          required
                          placeholder="Enter capacity"
                        />
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editLocation" class="form-label">
                          <i class="fas fa-map-marker-alt me-1"></i>Location *
                        </label>
                        <input
                          type="text"
                          id="editLocation"
                          class="form-control"
                          required
                          placeholder="Enter location"
                        />
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="editDescription" class="form-label">
                        <i class="fas fa-info-circle me-1"></i>Description
                      </label>
                      <textarea
                        id="editDescription"
                        class="form-control"
                        rows="4"
                        placeholder="Enter facility description..."
                      ></textarea>
                    </div>

                    <div class="mb-3">
                      <label for="editPhoto" class="form-label">
                        <i class="fas fa-camera me-1 text-muted"></i>Update Facility Photo
                      </label>
                      <input
                        type="file"
                        class="form-control"
                        id="editPhoto"
                        accept="image/*"
                      />
                      <div class="form-text">
                        Choose a new image to update the facility photo (leave empty to keep current photo)
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <!-- Properties & Equipment -->
                    <div class="properties-section">
                      <h6>
                        <i class="fas fa-cogs me-2"></i>Properties & Equipment
                      </h6>

                      <div id="propertiesList">
                        <!-- Dynamic properties will be added here -->
                      </div>

                      <button
                        type="button"
                        class="add-property-btn"
                        id="addPropertyBtn"
                      >
                        <i class="fas fa-plus me-2"></i>Add Property
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="modal-footer">
            <!-- View Mode Buttons -->
            <div id="viewButtons" class="w-100 d-flex justify-content-between">
              <div>
                <button id="editBtn" class="btn btn-outline-primary">
                  <i class="fas fa-edit me-1"></i>Edit Details
                </button>
                <button id="removeBtn" class="btn btn-outline-danger ms-2">
                  <i class="fas fa-trash me-1"></i>Remove Facility
                </button>
              </div>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                <i class="fas fa-times me-1"></i>Close
              </button>
            </div>

            <!-- Edit Mode Buttons -->
            <div
              id="editButtons"
              class="w-100 d-flex justify-content-between d-none"
            >
              <div>
                <button id="saveBtn" class="btn btn-success">
                  <i class="fas fa-save me-1"></i>Save Changes
                </button>
                <button id="cancelBtn" class="btn btn-outline-secondary ms-2">
                  <i class="fas fa-times me-1"></i>Cancel
                </button>
              </div>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                <i class="fas fa-times me-1"></i>Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Confirm Action</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <p id="confirmMessage">Are you sure you want to proceed?</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" id="confirmBtn" class="btn btn-danger">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Basic JavaScript for demonstration -->
    <script src="./add-facility.js"></script>
    <script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>

    <!-- Bootstrap JS Bundle (needed for modal) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>